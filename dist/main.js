!function(t){var e={};function i(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(a,r,function(e){return t[e]}.bind(null,r));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";function a(t){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){for(var e=new Uint8Array(t),i=new Array,a=0,r=0,n=new Array(3),s=new Array(4),o=e.length,h=0;o--;)if(n[a++]=e[h++],3==a){for(s[0]=(252&n[0])>>2,s[1]=((3&n[0])<<4)+((240&n[1])>>4),s[2]=((15&n[1])<<2)+((192&n[2])>>6),s[3]=63&n[2],a=0;a<4;a++)i+=c.charAt(s[a]);a=0}if(a){for(r=a;r<3;r++)n[r]=0;for(s[0]=(252&n[0])>>2,s[1]=((3&n[0])<<4)+((240&n[1])>>4),s[2]=((15&n[1])<<2)+((192&n[2])>>6),s[3]=63&n[2],r=0;r<a+1;r++)i+=c.charAt(s[r]);for(;a++<3;)i+="="}return i}function n(t){var e,i,a,r,n,s,o=new Array,c=0;if(t!=(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""))&&alert("Warning! Characters outside Base64 range in input string ignored."),t.length%4)return alert("Error: Input length is not a multiple of 4 bytes."),"";for(var d=0;c<t.length;)e=h.indexOf(t.charAt(c++))<<2|(r=h.indexOf(t.charAt(c++)))>>4,i=(15&r)<<4|(n=h.indexOf(t.charAt(c++)))>>2,a=(3&n)<<6|(s=h.indexOf(t.charAt(c++))),o[d++]=e,64!=n&&(o[d++]=i),64!=s&&(o[d++]=a);return o}var s="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(t){return a(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":a(t)},o={default:void 0,call:function(t,e,i){var a="";if("function"==typeof e&&(i=e,e={}),e={data:void 0===e?null:e},"function"==typeof i){var r="dscb"+window.dscb++;window[r]=i,e._dscbstub=r}return e=JSON.stringify(e),window._dsbridge?a=_dsbridge.call(t,e):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(a=prompt("_dsbridge="+t,e)),JSON.parse(a||"{}").data},register:function(t,e,i){i=i?window._dsaf:window._dsf,window._dsInit||(window._dsInit=!0,setTimeout(function(){o.call("_dsb.dsinit")},0)),"object"==(void 0===e?"undefined":s(e))?i._obs[t]=e:i[t]=e},registerAsyn:function(t,e){this.register(t,e,!0)},hasNativeMethod:function(t,e){return this.call("_dsb.hasNativeMethod",{name:t,type:e||"all"})},disableJavascriptDialogBlock:function(t){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==t})}};!function(){if(!window._dsf){var t,e={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,celerx:o,close:function(){o.call("_dsb.closePage")},_handleMessageFromNative:function(t){var e=JSON.parse(t.data),i={id:t.callbackId,complete:!0},a=this._dsf[t.method],r=this._dsaf[t.method],n=function(t,a){i.data=t.apply(a,e),o.call("_dsb.returnValue",i)},s=function(t,a){e.push(function(t,e){i.data=t,i.complete=!1!==e,o.call("_dsb.returnValue",i)}),t.apply(a,e)};if(a)n(a,this._dsf);else if(r)s(r,this._dsaf);else if(!(2>(a=t.method.split(".")).length)){t=a.pop();a=a.join(".");var c=(r=(r=this._dsf._obs)[a]||{})[t];c&&"function"==typeof c?n(c,r):(c=(r=(r=this._dsaf._obs)[a]||{})[t])&&"function"==typeof c&&s(c,r)}}};for(t in e)window[t]=e[t];o.register("_hasJavascriptMethod",function(t,e){return 2>(e=t.split(".")).length?!(!_dsf[e]&&!_dsaf[e]):(t=e.pop(),e=e.join("."),(e=_dsf._obs[e]||_dsaf._obs[e])&&!!e[t])})}}();var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d={callback:function(){return""}};o.register("provideScore",function(){return d.callback()}),t.exports={onStateReceived:function(t){return o.register("onStateReceived",function(e){var i=n(e);return t(new Uint8Array(i))})},onCourtModeStarted:function(t){return o.register("onCourtModeStarted",t)},getMatch:function(){var t=o.call("getMatch","123");try{t=JSON.parse(t)}catch(t){}return t},showCourtModeDialog:function(){return o.call("showCourtModeDialog")},start:function(){return o.call("start")},sendState:function(t){return o.call("sendState",r(t))},draw:function(t){return o.call("draw",r(t))},win:function(t){return o.call("win",r(t))},lose:function(t){return o.call("lose",r(t))},surrender:function(t){return o.call("surrender",r(t))},applyAction:function(t,e){return o.call("applyAction",r(t),e)},getOnChainState:function(t){return o.call("getOnChainState","123",function(e){var i=n(e);return t(new Uint8Array(i))})},getOnChainActionDeadline:function(t){return o.call("getOnChainActionDeadline","123",t)},getCurrentBlockNumber:function(){return o.call("getCurrentBlockNumber","123")},finalizeOnChainGame:function(t){return o.call("finalizeOnChainGame","123",t)},submitScore:function(t){return o.call("submitScore",t)},ready:function(){return o.call("ready")},onStart:function(t){return o.register("onStart",t)},provideScore:function(t){return d={callback:t}}}},function(t,e,i){"use strict";i.r(e);var a={};i.r(a),i.d(a,"getCurrentTime",function(){return r}),i.d(a,"random",function(){return n}),i.d(a,"randomPositiveNegative",function(){return s}),i.d(a,"isFunction",function(){return o}),i.d(a,"isTouchDevice",function(){return c}),i.d(a,"requestAnimationFrameTool",function(){return h}),i.d(a,"arraySwap",function(){return d});const r=()=>performance.now(),n=(t,e)=>Math.random()*(e-t)+t,s=()=>Math.random()<.5?-1:1,o=t=>"function"==typeof t,c=()=>"ontouchstart"in window||window.navigator.msMaxTouchPoints,h=(()=>{let t=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>{window.setTimeout(()=>{const i=r();e(i);const a=r();t=1e3/60-(a-i)},t)})})(),d=(t,e,i)=>{const a=t[i];t[i]=t[e],t[e]=a};var l={linear:function(t,e,i,a){return i*t/a+e},easeIn:function(t,e,i,a){return i*(t/=a)*t+e},easeOut:function(t,e,i,a){return-i*(t/=a)*(t-2)+e},easeInOut:function(t,e,i,a){return(t/=a/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e}};const{requestAnimationFrameTool:u,isFunction:g,isTouchDevice:m}=a;class f{constructor(t={}){const{name:e,painter:i,action:a,trigger:r}=t;this.name=e,this.x=0,this.y=0,this.width=0,this.height=0,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.visible=!0,this.painter=i||null,this.action=a||null,this.trigger=r||null,this.ready=!1}paint(t){null!==this.painter&&this.visible&&this.painter(this,t)}update(t,e){null!==this.action&&this.action(this,t,e)}updateWidth(t){this.width=t,this.calWidth=t/2}updateHeight(t){this.height=t,this.calHeight=t/2}}var b="LAND",p="OUT",y=i(0),v=i.n(y),O=function(t){return t.checkTimeMovement("MOVE_DOWN_MOVEMENT")},T=function(t,e){var i=e?e.pixelsPerFrame:t.pixelsPerFrame.bind(t),a=t.getVariable("SUCCESS_COUNT"),r=2*t.getVariable("BLOCK_HEIGHT");return i(a<=4?1.25*r:r)},w=function(t,e){var i,a=t.getVariable("SUCCESS_COUNT"),r=t.getVariable("GAME_SCORE"),n=t.getVariable("GAME_USER_OPTION").hookSpeed;if(n)return n(a,r);switch(!0){case a<1:i=0;break;case a<10:i=1;break;case a<20:i=.8;break;case a<30:i=.7;break;default:i=.74}return t.getVariable("HARD_MODE")&&(i=1.1),Math.sin(e/(200/i))},_=function(t,e){var i=t.getVariable("SUCCESS_COUNT"),a=t.getVariable("GAME_SCORE"),r=t.getVariable("GAME_USER_OPTION").landBlockSpeed;if(r)return r(i,a);var n,s=t.width;switch(!0){case i<5:n=0;break;case i<13:n=.001;break;case i<23:n=.002;break;default:n=.003}return Math.cos(e/200)*n*s},E=function(t){return t.checkTimeMovement("HOOK_DOWN_MOVEMENT")?"HOOK_DOWN":t.checkTimeMovement("HOOK_UP_MOVEMENT")?"HOOK_UP":"HOOK_NORMAL"},x=function(t){var e=t.getVariable("GAME_USER_OPTION").setGameFailed,i=t.getVariable("FAILED_COUNT")+1;t.setVariable("FAILED_COUNT",i),t.setVariable("PERFECT_COUNT",0);var a=t.getVariable("GAME_USER_OPTION"),r=(a.setGameScore,a.successScore),n=a.perfectScore,s=t.getVariable("PERFECT_COUNT",0),o=t.getVariable("GAME_SCORE"),c=isPerfect?s+1:0,h=o+(r||25)+(n||25)*c;e&&e(i),i>=3&&(t.pauseAudio("bgm"),t.playAudio("game-over"),t.setVariable("GAME_START_NOW",!1),v.a.submitScore(h))},A=function(t,e){var i=t.getVariable("GAME_USER_OPTION"),a=i.setGameScore,r=i.successScore,n=i.perfectScore,s=t.getVariable("PERFECT_COUNT",0),o=t.getVariable("GAME_SCORE"),c=e?s+1:0,h=o+(r||25)+(n||25)*c;t.setVariable("GAME_SCORE",h),t.setVariable("PERFECT_COUNT",c),a&&a(h)},I=function(t,e){var i=e.string,a=e.size,r=e.x,n=e.y,s=e.textAlign,o=t.ctx,c=a,h=.1*c;o.save(),o.beginPath();var d=o.createLinearGradient(0,0,0,n);d.addColorStop(0,"#FAD961"),d.addColorStop(1,"#F76B1C"),o.fillStyle=d,o.lineWidth=h,o.strokeStyle="#FFF",o.textAlign=s||"center",o.font="".concat(c,"px ").concat("wenxue"),o.strokeText(i,r,n),o.fillText(i,r,n),o.restore()},M=function(t,e,i){var a=e+1>=t.length?t.length-1:e,r=t[a],n=t[a+1>=t.length-1?a:a+1],s=function(t){var e=r[t],a=n[t];return Math.round(e+(a-e)*i)};return"rgb(".concat(s(0),", ").concat(s(1),", ").concat(s(2),")")},S=function(t){!function(t){var e=t.ctx.createLinearGradient(0,0,0,t.height),i=[[200,255,150],[105,230,240],[90,190,240],[85,100,190],[52,119,237],[52,119,237],[52,119,237]],a=t.getVariable("BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",0);O(t)&&t.setVariable("BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",a+1.5*T(t));var r=parseInt(a/t.height,10),n=a%t.height/t.height,s=M(i,r,n),o=M(i,r+1,n);e.addColorStop(0,o),e.addColorStop(1,s),t.ctx.fillStyle=e,t.ctx.beginPath(),t.ctx.rect(0,0,t.width,t.height),t.ctx.fill();var c=function(){t.ctx.fillStyle="rgba(255, 255, 255, 0.7)",t.ctx.fillRect(0,0,t.width,t.height)};t.getTimeMovement("LIGHTNING_MOVEMENT",[],function(){},{before:c,after:c})}(t),function(t){var e=t.getImg("background"),i=e.width,a=e.height*t.width/i,r=t.getVariable("BACKGROUND_IMG_OFFSET_HEIGHT",t.height-a);r>t.height||(t.getTimeMovement("MOVE_DOWN_MOVEMENT",[[r,r+T(t,{pixelsPerFrame:function(t){return t/2}})]],function(t){r=t},{name:"background"}),t.getTimeMovement("BG_INIT_MOVEMENT",[[r,r+a/4]],function(t){r=t}),t.setVariable("BACKGROUND_IMG_OFFSET_HEIGHT",r),t.setVariable("LINE_INITIAL_OFFSET",t.height-.394*a),t.ctx.drawImage(e,0,r,t.width,a))}(t)},k=function(t,e,i){var a=t;a.ready||(a.y=e.getVariable("LINE_INITIAL_OFFSET"),a.ready=!0,a.collisionX=e.width-e.getVariable("BLOCK_WIDTH")),e.getTimeMovement("MOVE_DOWN_MOVEMENT",[[t.y,t.y+T(e,{pixelsPerFrame:function(t){return t/2}})]],function(e){t.y=e},{name:"line"});var r=_(e,i);t.x+=r,t.collisionX+=r},N=function(t,e){var i=e.ctx;e.debug&&(i.save(),i.beginPath(),i.strokeStyle="red",i.moveTo(t.x,t.y),i.lineTo(t.collisionX,t.y),i.lineWidth=1,i.stroke(),i.restore())},L=function(t){var e=t.count,i=function(t){return t[Math.floor(Math.random()*t.length)]};t.imgName=i(e>6?["c4","c5","c6","c7","c8"]:["c1","c2","c3"])},C=function(t,e){if(!t.ready){t.ready=!0,L(t),t.width=e.getVariable("CLOUD_SIZE"),t.height=e.getVariable("CLOUD_SIZE");var i=e.width,a=e.height,r=[{x:.1*i,y:.66*-a},{x:.65*i,y:.33*-a},{x:.1*i,y:0},{x:.65*i,y:.33*a}][t.index-1];t.x=e.utils.random(r.x,1.2*r.x),t.originX=t.x,t.ax=e.pixelsPerFrame(t.width*e.utils.random(.05,.08)*e.utils.randomPositiveNegative()),t.y=e.utils.random(r.y,1.2*r.y)}t.x+=t.ax,(t.x>=t.originX+t.width||t.x<=t.originX-t.width)&&(t.ax*=-1),O(e)&&(t.y+=1.2*T(e)),t.y>=e.height&&(t.y=.66*-e.height,t.count+=4,L(t))},V=function(t,e){var i=e.ctx,a=e.getImg(t.imgName);i.drawImage(a,t.x,t.y,t.width,t.height)},R=function(t,e,i){var a=e.getVariable("ROPE_HEIGHT");t.ready||(t.x=e.width/2,t.y=-1.5*a,t.ready=!0),e.getTimeMovement("HOOK_UP_MOVEMENT",[[t.y,t.y-a]],function(e){t.y=e},{after:function(){t.y=-1.5*a}}),e.getTimeMovement("HOOK_DOWN_MOVEMENT",[[t.y,t.y+a]],function(e){t.y=e},{name:"hook"});var r=e.getVariable("INITIAL_ANGLE");t.angle=r*w(e,i),t.weightX=t.x+Math.sin(t.angle)*a,t.weightY=t.y+Math.cos(t.angle)*a},P=function(t,e){var i=e.ctx,a=e.getVariable("ROPE_HEIGHT"),r=.1*a,n=e.getImg("hook");i.save(),i.translate(t.x,t.y),i.rotate(2*Math.PI-t.angle),i.translate(-t.x,-t.y),e.ctx.drawImage(n,t.x-r/2,t.y,r,a+5),i.restore()},F=function(t,e,i){var a=e.width,r=e.height,n=t.name;if(!t.ready){t.ready=!0;var s=.2*a;t.updateWidth(s),t.height=.46*s,t.x=e.calWidth-t.calWidth,t.y=.45*r,"tutorial"!==n&&(t.y+=1.2*t.height)}"tutorial"!==n&&(t.y+=Math.cos(i/200)*t.height*.01)},D=function(t,e){if(!e.checkTimeMovement("TUTORIAL_MOVEMENT")&&"HOOK_NORMAL"===E(e)){var i=e.ctx,a=t.name,r=e.getImg(a);i.drawImage(r,t.x,t.y,t.width,t.height)}},G=function(t,e){"ROTATE_LEFT"===t.status?t.y-t.width>=e.height&&(t.visible=!1,t.status=p,x(e)):t.y>=e.height&&(t.visible=!1,t.status=p,x(e))},U=function(t,e,i){var a=t,r=e.getVariable("ROPE_HEIGHT");if(a.visible){a.ready||(a.ready=!0,a.status="SWING",t.updateWidth(e.getVariable("BLOCK_WIDTH")),t.updateHeight(e.getVariable("BLOCK_HEIGHT")),t.x=e.width/2,t.y=-1.5*r);var n=e.getInstance("line");switch(a.status){case"SWING":e.getTimeMovement("HOOK_DOWN_MOVEMENT",[[t.y,t.y+r]],function(e){t.y=e},{name:"block"}),function(t,e,i){var a=e.getVariable("ROPE_HEIGHT");if("SWING"===t.status){var r=t,n=e.getVariable("INITIAL_ANGLE");r.angle=n*w(e,i),r.weightX=r.x+Math.sin(r.angle)*a,r.weightY=r.y+Math.cos(r.angle)*a}}(t,e,i);break;case"BEFORE_DROP":a.x=t.weightX-t.calWidth,a.y=t.weightY+.3*t.height,a.rotate=0,a.ay=e.pixelsPerFrame(3e-4*e.height),a.startDropTime=i,a.status="DROP";break;case"DROP":var s=i-a.startDropTime;a.startDropTime=i,a.vy+=a.ay*s,a.y+=a.vy*s+.5*a.ay*Math.pow(s,2);var o=function(t,e){return t.y+t.height>=e.y?t.x<e.x-t.calWidth||t.x>e.collisionX+t.calWidth?1:t.x<e.x?2:t.x>e.collisionX?3:t.x>e.x+.8*t.calWidth&&t.x<e.x+1.2*t.calWidth?5:4:0}(t,n),c=n.y-t.height,h=function(t){t.originOutwardAngle=Math.atan(t.height/t.outwardOffset),t.originHypotenuse=Math.sqrt(Math.pow(t.height,2)+Math.pow(t.outwardOffset,2)),e.playAudio("rotate")};switch(o){case 1:G(t,e);break;case 2:a.status="ROTATE_LEFT",t.y=c,t.outwardOffset=n.x+t.calWidth-t.x,h(t);break;case 3:a.status="ROTATE_RIGHT",t.y=c,t.outwardOffset=n.collisionX+t.calWidth-t.x,h(t);break;case 4:case 5:a.status=b;var d=e.getVariable("SUCCESS_COUNT");!function(t){var e=t.getVariable("GAME_USER_OPTION").setGameSuccess,i=t.getVariable("SUCCESS_COUNT")+1;t.setVariable("SUCCESS_COUNT",i),t.getVariable("HARD_MODE")&&t.setVariable("ROPE_HEIGHT",t.height*t.utils.random(.35,.55)),e&&e(i)}(e),e.setTimeMovement("MOVE_DOWN_MOVEMENT",500),10!==d&&15!==d||e.setTimeMovement("LIGHTNING_MOVEMENT",150),t.y=c,n.y=c,n.x=a.x-a.calWidth,n.collisionX=n.x+a.width;var l=.3*a.width;(a.x>e.width-2*l||a.x<-l)&&e.setVariable("HARD_MODE",!0),5===o?(t.perfect=!0,A(e,!0),e.playAudio("drop-perfect")):(A(e),e.playAudio("drop"))}break;case b:e.getTimeMovement("MOVE_DOWN_MOVEMENT",[[t.y,t.y+T(e,{pixelsPerFrame:function(t){return t/2}})]],function(i){t.visible&&(t.y=i,t.y>e.height&&(t.visible=!1))},{name:t.name}),t.x+=_(e,i);break;case"ROTATE_LEFT":case"ROTATE_RIGHT":var u="ROTATE_RIGHT"===a.status,g=e.pixelsPerFrame(4*Math.PI),m=u?t.rotate>1.3:t.rotate<-1.3,f=u?1:-1;if(m)t.rotate+=g/8*f,t.y+=e.pixelsPerFrame(.7*e.height),t.x+=e.pixelsPerFrame(.3*e.width)*f;else{var p=(t.calWidth-t.outwardOffset)/t.calWidth;p=p>.5?p:.5,t.rotate+=g*p*f;var y=t.originOutwardAngle+t.rotate,v=u?n.collisionX+t.calWidth:n.x+t.calWidth,O=n.y;t.x=v-Math.cos(y)*t.originHypotenuse,t.y=O-Math.sin(y)*t.originHypotenuse}G(t,e)}}},H=function(t,e){var i=t.perfect;console.log(t.name);var a=Number(String(t.name.split("_")[1]).charAt(0))%5+1;console.log("drawBlock"+a);var r=e.getImg(i?"block-perfect-"+a:"block-"+a);e.ctx.drawImage(r,t.x,t.y,t.width,t.height)},W=function(t,e){switch(t.status){case"SWING":!function(t,e){var i=Number(String(t.name.split("_")[1]).charAt(0))%5+1,a=e.getImg("blockRope-"+i);e.ctx.drawImage(a,t.weightX-t.calWidth,t.weightY,t.width,1.3*t.height);var r=t.weightX-t.calWidth;e.debugLineY(r)}(t,e);break;case"DROP":case b:H(t,e);break;case"ROTATE_LEFT":case"ROTATE_RIGHT":!function(t,e){var i=e.ctx;i.save(),i.translate(t.x,t.y),i.rotate(t.rotate),i.translate(-t.x,-t.y),H(t,e),i.restore()}(t,e)}},K=function(t,e){var i=t.visible,a=t.ready,r=t.type;if(i){var n=e.getVariable("CLOUD_SIZE");if(!a){var s=function(t,e){var i=t.width,a=t.height,r=t.utils.random,n=t.getVariable("CLOUD_SIZE");return{bottomToTop:{x:i*r(.3,.7),y:a,vx:0,vy:.7*t.pixelsPerFrame(a)*-1},leftToRight:{x:-1*n,y:a*r(.3,.6),vx:.4*t.pixelsPerFrame(i),vy:.1*t.pixelsPerFrame(a)*-1},rightToLeft:{x:i,y:a*r(.2,.5),vx:.4*t.pixelsPerFrame(i)*-1,vy:.1*t.pixelsPerFrame(a)},rightTopToLeft:{x:i,y:0,vx:.6*t.pixelsPerFrame(i)*-1,vy:.5*t.pixelsPerFrame(a)}}[e]}(e,r);t.ready=!0,t.width=n,t.height=n,t.x=s.x,t.y=s.y,t.vx=s.vx,t.vy=s.vy}t.x+=t.vx,t.y+=t.vy,(t.y+n<0||t.y>e.height||t.x+n<0||t.x>e.width)&&(t.visible=!1)}},B=function(t,e){var i=e.ctx,a=e.getImg(t.imgName);i.drawImage(a,t.x,t.y,t.width,t.height)},j=function(t,e,i){if(t.getVariable("FLIGHT_COUNT")!==e){var a=new f({name:"flight_".concat(e),action:K,painter:B});a.imgName="f".concat(e),a.type=i,t.addInstance(a,"FLIGHT_LAYER"),t.setVariable("FLIGHT_COUNT",e)}},X=function(t){if(t.getVariable("GAME_START_NOW")){var e=t.getVariable("SUCCESS_COUNT",0),i=t.getVariable("FAILED_COUNT"),a=t.getVariable("GAME_SCORE",0),r=Number(e)>99?.1*t.width:0;I(t,{string:"pts",size:.06*t.width,x:.24*t.width+r,y:.12*t.width,textAlign:"left"}),I(t,{string:e,size:.17*t.width,x:.22*t.width+r,y:.2*t.width,textAlign:"right"});var n=t.getImg("score"),s=n.width,o=n.height,c=.35*t.width,h=o*c/s;t.ctx.drawImage(n,.61*t.width,.038*t.width,c,h),I(t,{string:a,size:.06*t.width,x:.9*t.width,y:.11*t.width,textAlign:"right"});for(var d=t.ctx,l=t.getImg("heart"),u=l.width,g=l.height,m=.08*t.width,f=g*m/u,b=1;b<=3;b+=1)d.save(),b<=i&&(d.globalAlpha=.2),d.drawImage(l,.66*t.width+(b-1)*m,.16*t.width,m,f),d.restore()}},Y=function(t){if(t.getVariable("GAME_START_NOW")){var e=t.getInstance("block_".concat(t.getVariable("BLOCK_COUNT")));if(!e||[b,p].indexOf(e.status)>-1){if(O(t)&&T(t))return;if(t.checkTimeMovement("HOOK_UP_MOVEMENT"))return;var i=function(t){var e=t.getVariable("SUCCESS_COUNT"),i=t.getVariable("GAME_SCORE"),a=t.getVariable("GAME_USER_OPTION").hookAngle;if(a)return a(e,i);if(t.getVariable("HARD_MODE"))return 90;switch(!0){case e<10:return 30;case e<20:return 60;default:return 80}}(t),a=Math.PI*t.utils.random(i,i+5)*t.utils.randomPositiveNegative()/180;t.setVariable("BLOCK_COUNT",t.getVariable("BLOCK_COUNT")+1),t.setVariable("INITIAL_ANGLE",a),t.setTimeMovement("HOOK_DOWN_MOVEMENT",500);var r=new f({name:"block_".concat(t.getVariable("BLOCK_COUNT")),action:U,painter:W});t.addInstance(r)}switch(Number(t.getVariable("SUCCESS_COUNT",0))){case 2:j(t,1,"leftToRight");break;case 6:j(t,2,"rightToLeft");break;case 8:j(t,3,"leftToRight");break;case 14:j(t,4,"bottomToTop");break;case 18:j(t,5,"bottomToTop");break;case 22:j(t,6,"bottomToTop");break;case 25:j(t,7,"rightTopToLeft")}}};v.a.ready(),window.TowerGame=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,r=new class{constructor(t={}){if(!document.createElement("canvas").getContext)return void window.alert("HTML5 Canvas is not supported in your browser.");const{canvasId:e,debug:i,width:r,height:n,highResolution:s,loadLimit:o,soundOn:c}=t;let h=r||window.innerWidth,d=n||window.innerHeight;this.canvas=document.getElementById(e),s&&(this.canvas.style.width=`${h}px`,this.canvas.style.height=`${d}px`,h*=2,d*=2),this.highResolution=s,this.canvas.width=h,this.canvas.height=d,this.width=this.canvas.width,this.height=this.canvas.height,this.calWidth=.5*this.width,this.calHeight=.5*this.height,this.debug=!!i,this.ctx=this.canvas.getContext("2d"),this.defaultLayer="default",this.layerArr=[this.defaultLayer],this.instancesObj={},this.instancesObj[this.defaultLayer]=[],this.instancesReactionArr=[],this.utils=a,this.customVariable={};const l=this;this.isTouchDevice=m(),this.debugArr=[],this.assetsObj={image:{},audio:{}},this.assetsCount={image:0,audio:0},this.assetsErrorQueue=[],this.assetsErrorCount=0,this.loadLimit=o||3,this.soundOn=!!c,this.fps=0,this.lastTime=0,this.lastPausedAt=0,this.pausedTime=0,this.paused=!1,this.timeMovement={},this.timeMovementStartArr=[],this.timeMovementFinishArr=[],this.keyUpListeners={},this.keyDownListeners={},this.keyPressListeners={},this.startAnimate=(()=>{}),this.paintUnderInstance=(()=>{}),this.paintAboveInstance=(()=>{}),this.endAnimate=(()=>{}),this.touchStartListener=(()=>{}),this.touchEndListener=(()=>{}),this.touchMoveListener=(()=>{}),document.addEventListener("keyup",t=>{l.keyListener(t,"keyup")},!1),document.addEventListener("keydown",t=>{l.keyListener(t,"keydown")},!1),document.addEventListener("keypress",t=>{l.keyListener(t,"keypress")},!1),this.isTouchDevice?(document.addEventListener("touchstart",t=>{l.touchStartListener(t)},!1),document.addEventListener("touchend",t=>{l.touchEndListener(t)},!1),document.addEventListener("touchmove",t=>{l.touchMoveListener(t)},!1)):(document.addEventListener("mousedown",t=>{l.touchStartListener(t)},!1),document.addEventListener("mouseup",t=>{l.touchEndListener(t)},!1),document.addEventListener("mousemove",t=>{l.touchMoveListener(t)},!1))}triggerReaction(t,e){let i=t,a=e;this.highResolution&&(i*=2,a*=2),this.instancesReactionArr.forEach(t=>{t.visible&&i>=t.x&&i<=t.x+t.width&&a>=t.y&&a<=t.y+t.height&&t.trigger(t,this)})}addAudio(t,e,i=0){if(!this.soundOn)return;i||(this.assetsCount.audio+=1);const a=new window.Audio;a.src=e,this.assetsObj.audio[t]=a,a.addEventListener("error",()=>{this.assetsErrorQueue.push({name:t,src:e,retry:i+1,type:"audio"})},!1),a.load()}getAudio(t){return this.assetsObj.audio[t]}playAudio(t,e=!1){if(!this.soundOn)return;const i=this.getAudio(t);if(i){if(i.play(),!e)return;i.addEventListener("ended",()=>{i.currentTime=0,i.play()},!1)}}pauseAudio(t){const e=this.getAudio(t);e&&e.pause()}setVariable(t,e){this.customVariable[t]=e}getVariable(t,e=null){const i=this.customVariable[t];return i||(null!==e?(this.setVariable(t,e),e):null)}addImg(t,e,i=0){i||(this.assetsCount.image+=1);const a=new window.Image;a.src=e,a.onload=(()=>{this.assetsObj.image[t]=a}),a.onerror=(()=>{this.assetsErrorQueue.push({name:t,src:e,retry:i+1,type:"image"})})}getImg(t){return this.assetsObj.image[t]}animate(t){const e=t-this.pausedTime,i=this;this.paused?setTimeout(()=>{this.animate.call(i,e)},100):(this.tick(e),this.clean(),this.startAnimate(this,e),this.paintUnderInstance(this),this.updateInstances(e),this.paintInstances(),this.paintAboveInstance(),this.endAnimate(this,e),this.tickTimeMovement(),this.debug&&this.showFps(),this.debug&&this.drawDebug(),u(t=>{this.animate.call(i,t)}))}showFps(){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.font=`${this.highResolution?32:16}px Arial`,this.ctx.fillText(`FPS: ${this.fps.toFixed()}`,5,this.highResolution?40:20),this.ctx.restore()}debugLineX(t){this.debugArr.push({type:"lineX",y:t})}debugLineY(t){this.debugArr.push({type:"lineY",x:t})}debugDot(t,e){this.debugArr.push({type:"dot",x:t,y:e})}drawDebug(){this.debugArr.forEach(t=>{const{type:e,x:i,y:a}=t;switch(e){case"dot":this.drawDebugDot(i,a);break;case"lineX":this.drawDebugLine(null,a);break;case"lineY":this.drawDebugLine(i,null)}}),this.instancesReactionArr.forEach(t=>{t.visible&&(this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.rect(t.x,t.y,t.width,t.height),this.ctx.stroke())})}drawDebugLine(t,e){let i=[0,e],a=[this.width,e];t&&(i=[t,0],a=[t,this.height]),this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.moveTo(...i),this.ctx.lineTo(...a),this.ctx.stroke(),this.ctx.restore()}drawDebugDot(t,e){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(t,e,2,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(t,e,1,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.restore()}tick(t){this.updateFps(t),this.lastTime=t}updateFps(t){0===this.lastTime?this.fps=60:this.fps=1e3/(t-this.lastTime)}pixelsPerFrame(t){return t/this.fps}tickTimeMovement(){this.timeMovementStartArr.forEach(t=>{this.timeMovement[t].processing=!0}),this.timeMovementStartArr=[],this.timeMovementFinishArr.forEach(t=>{delete this.timeMovement[t]}),this.timeMovementFinishArr=[]}getTimeMovement(t,e,i,a={}){const{before:r,after:n}=a,s=l[a.easing||"linear"],o=a.name||"default",c=this.timeMovement[t];if(!c)return;c.processing||(this.timeMovementStartArr.push(t),c.store[o]=[],e.forEach(t=>{c.store[o].push({start:parseFloat(t[0]),end:parseFloat(t[1])})}),r&&r());const h=(t=!1)=>{const{duration:e}=c;let a=e;if(!t){const t=this.utils.getCurrentTime(),{startTime:e}=c;a=t-e}const r=c.store[o].map(t=>s(a,t.start,t.end-t.start,e));i.apply(this,r)};this.checkTimeMovement(t)?h():(this.timeMovementFinishArr.push(t),h(!0),n&&n())}checkTimeMovement(t){const e=this.timeMovement[t]||{};return this.utils.getCurrentTime()<=e.endTime}setTimeMovement(t,e){const i=this.utils.getCurrentTime();this.timeMovement[t]={startTime:i,endTime:i+e,duration:e,store:{}}}clean(){this.ctx.clearRect(0,0,this.width,this.height),this.debugArr=[]}addLayer(t){this.layerArr.push(t),this.instancesObj[t]=[]}removeLayer(t){this.layerArr=this.layerArr.filter(e=>e!==t),delete this.instancesObj[t]}swapLayer(t,e){this.utils.arraySwap(this.layerArr,t,e)}addInstance(t,e=this.defaultLayer){this.instancesObj[e].push(t),t.trigger&&this.instancesReactionArr.push(t)}getInstance(t,e=this.defaultLayer){return this.instancesObj[e].filter(e=>e.name===t)[0]}removeInstance(t,e=this.defaultLayer){const i=this.getInstance(t,e);i&&(this.instancesObj[e]=this.instancesObj[e].filter(e=>e.name!==t),i.trigger&&(this.instancesReactionArr=this.instancesReactionArr.filter(e=>e.name!==t)))}updateInstances(t){this.layerArr.forEach(e=>{this.instancesObj[e].forEach(e=>{e.update&&e.update(this,t)})})}paintInstances(){this.layerArr.forEach(t=>{this.instancesObj[t].forEach(t=>{t.paint&&t.paint(this)})})}togglePaused(){const t=this.utils.getCurrentTime();this.paused=!this.paused,this.paused?this.lastPausedAt=t:this.pausedTime+=t-this.lastPausedAt}addKeyUpListener(t,e){this.keyUpListeners[t]=e}addKeyDownListener(t,e){this.keyDownListeners[t]=e}addKeyPressListener(t,e){this.keyPressListeners[t]=e}findKeyListener(t,e){return"keyup"===e?this.keyUpListeners[t]:"keydown"===e?this.keyDownListeners[t]:this.keyPressListeners[t]}keyListener(t,e){let i;switch(t.keyCode){case 13:i="enter";break;case 32:i="space";break;case 37:i="leftArrow";break;case 39:i="rightArrow";break;case 38:i="upArrow";break;case 40:i="downArrow";break;default:i=t.keyCode}const a=this.findKeyListener(i,e);a&&a()}load(t,e){const i=setInterval(()=>{const a=this.assetsCount.image+this.assetsCount.audio,r=Object.keys(this.assetsObj.image).length+Object.keys(this.assetsObj.audio).length;e&&g(e)&&e({success:r,failed:this.assetsErrorCount,total:a}),this.assetsErrorQueue.length>0&&(this.assetsErrorQueue.forEach(t=>{const{retry:e,name:i,src:a,type:r}=t;e>=this.loadLimit?this.assetsErrorCount+=1:"image"===r?this.addImg(i,a,e):this.addAudio(i,a,e)}),this.assetsErrorQueue=[]),r===a&&(t&&g(t)?t():this.init(),clearInterval(i))},200)}init(){const t=this;u(e=>{this.animate.call(t,e)})}}({canvasId:t.canvasId,highResolution:!0,width:e,height:i,soundOn:t.soundOn}),n=function(t){return"./assets/".concat(t)};r.addImg("background",n("background.png")),r.addImg("hook",n("hook.png")),r.addImg("blockRope-1",n("block-1-rope.png")),r.addImg("block-1",n("block-1.png")),r.addImg("block-perfect-1",n("block-1-perfect.png")),r.addImg("blockRope-2",n("block-2-rope.png")),r.addImg("block-2",n("block-2.png")),r.addImg("block-perfect-2",n("block-2-perfect.png")),r.addImg("blockRope-3",n("block-3-rope.png")),r.addImg("block-3",n("block-3.png")),r.addImg("block-perfect-3",n("block-3-perfect.png")),r.addImg("blockRope-4",n("block-2-rope.png")),r.addImg("block-4",n("block-2.png")),r.addImg("block-perfect-4",n("block-2-perfect.png")),r.addImg("blockRope-5",n("block-2-rope.png")),r.addImg("block-5",n("block-2.png")),r.addImg("block-perfect-5",n("block-2-perfect.png"));for(var s=1;s<=8;s+=1)r.addImg("c".concat(s),n("c".concat(s,".png")));r.addLayer("FLIGHT_LAYER");for(var o=1;o<=7;o+=1)r.addImg("f".concat(o),n("f".concat(o,".png")));r.swapLayer(0,1),r.addImg("tutorial",n("tutorial.png")),r.addImg("tutorial-arrow",n("tutorial-arrow.png")),r.addImg("heart",n("heart.png")),r.addImg("score",n("score.png")),r.addAudio("drop-perfect",n("drop-perfect.mp3")),r.addAudio("drop",n("drop.mp3")),r.addAudio("game-over",n("game-over.mp3")),r.addAudio("rotate",n("rotate.mp3")),r.addAudio("bgm",n("bgm.mp3")),r.setVariable("BLOCK_WIDTH",.25*r.width),r.setVariable("BLOCK_HEIGHT",.71*r.getVariable("BLOCK_WIDTH")),r.setVariable("CLOUD_SIZE",.3*r.width),r.setVariable("ROPE_HEIGHT",.4*r.height),r.setVariable("BLOCK_COUNT",0),r.setVariable("SUCCESS_COUNT",0),r.setVariable("FAILED_COUNT",0),r.setVariable("GAME_SCORE",0),r.setVariable("HARD_MODE",!1),r.setVariable("GAME_USER_OPTION",t);for(var c=1;c<=4;c+=1){var h=new f({name:"cloud_".concat(c),action:C,painter:V});h.index=c,h.count=5-c,r.addInstance(h)}var d=new f({name:"line",action:k,painter:N});r.addInstance(d);var b=new f({name:"hook",action:R,painter:P});return r.addInstance(b),r.startAnimate=Y,r.endAnimate=X,r.paintUnderInstance=S,r.addKeyDownListener("enter",function(){r.debug&&r.togglePaused()}),r.touchStartListener=function(){!function(t){t.getVariable("GAME_START_NOW")&&(t.debug&&t.paused||"HOOK_NORMAL"===E(t)&&(t.removeInstance("tutorial"),t.removeInstance("tutorial-arrow"),v.a.onStart(function(t){var e=t.getInstance("block_".concat(t.getVariable("BLOCK_COUNT")));e&&"SWING"===e.status&&(t.setTimeMovement("HOOK_UP_MOVEMENT",500),e.status="BEFORE_DROP")})))}(r)},r.playBgm=function(){r.playAudio("bgm",!0)},r.pauseBgm=function(){r.pauseAudio("bgm")},r.start=function(){var t=new f({name:"tutorial",action:F,painter:D});r.addInstance(t);var e=new f({name:"tutorial-arrow",action:F,painter:D});r.addInstance(e),r.setTimeMovement("BG_INIT_MOVEMENT",500),r.setTimeMovement("TUTORIAL_MOVEMENT",500),r.setVariable("GAME_START_NOW",!0)},r}}]);